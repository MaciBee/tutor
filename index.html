<!DOCTYPE html>
<html>
<head>
    <title>Tutor & Student Login </title>
<!--<script src="https://cdn.tailwindcss.com"></script>-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body>

<!-- NEW: Landing Page Section -->
<div id="landingPage">
    <!-- Hero Section -->

    <!-- How It Works Section -->
    <section style="padding: 5px 5px; background: #f8f9fa;">
        <div style="max-width: 1000px; margin: 0 auto; text-align: center;">
            <h3 style="font-size: 2em; margin: 0 0 40px 0; color: #333;">Connect With Personalized Tutors</h2>
            
        </div>
    </section>
</div>

<div id="loginSection">

    <h2>Login</h2>    
    <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
    
    <div id="result"></div>
</div>

<!--tailwind via CDN 7.18 --> 
<!--<div id="loginSection">
  <div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow mt-10">
    <h2 class="text-xl font-bold mb-6 text-center">Sign in to your account</h2>
    <form id="loginForm" class="space-y-4">
      <input class="w-full p-3 border rounded focus:outline-none focus:ring" type="email" id="email" placeholder="Email" required>
      <input class="w-full p-3 border rounded focus:outline-none focus:ring" type="password" id="password" placeholder="Password" required>
      <button class="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 transition" type="submit">Login</button>
    </form>
    <div id="result" class="mt-4"></div>
  </div>
</div>
-->
<!--8.6<div id="tutorMarketplace">
	<button onclick="loadAllTutors()">Browse All Tutors</button>

	<div class="content">

	<div id="tutorList"></div> 
</div>
-->

<!--
<div id="tutorMarketplace">
    <h2>Find a Tutor</h2>
    <button onclick="loadTutors()">Browse All Tutors</button>
    <div id="tutorList"></div>
</div>
-->
<!--tailwind 7.18-->

<!--<div id="registerSection" class="max-w-md mx-auto bg-white p-4 rounded-lg shadow mt-6 mb-6">
  <h2 class="text-xl font-bold mb-4 text-center">Create Account</h2>
  <form id="registerForm" class="space-y-3">
    <input class="w-full p-2 border rounded focus:outline-none focus:ring" type="email" id="regEmail" placeholder="Email" required>
    <input class="w-full p-2 border rounded focus:outline-none focus:ring" type="password" id="regPassword" placeholder="Password" required>
    <select class="w-full p-2 border rounded focus:outline-none focus:ring" id="regRole" required>
      <option value="">Choose your role</option>
      <option value="student">I'm a Student</option>
      <option value="tutor">I'm a Tutor</option>
    </select>
    <button class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition" type="submit">Sign Up</button>
  </form>
  <div id="registerResult" class="mt-3"></div>
</div>
-->

<!-- Tutor Profile Creation Form -->
<!--!!profile selection edit 7.21 to include subject--> 
<!--7.22 commented out <div id="tutorProfileSection" style="display: none;">
    <h2>Create Your Tutor Profile</h2>
    <form id="tutorProfileForm">
        
<!-- NEW: Subject selection --
        <label>What subjects do you teach?</label>
        <div id="subjectCheckboxes" style="margin: 10px 0;">
            <input type="checkbox" name="subjects" value="1" id="math"> <label for="math">Math</label><br>
            <input type="checkbox" name="subjects" value="2" id="french"> <label for="french">French</label><br>
            <input type="checkbox" name="subjects" value="3" id="piano"> <label for="piano">Piano</label><br>
            <input type="checkbox" name="subjects" value="4" id="programming"> <label for="programming">Programming</label><br>
        </div>
        
        <textarea id="bio" placeholder="Tell students about yourself, your experience, teaching style..." rows="4" required></textarea>
        <input type="number" id="hourlyRate" placeholder="Hourly Rate ($)" min="10" max="200" step="0.50" required>
        <input type="tel" id="phone" placeholder="Phone Number (optional)">
        <button type="submit">Create Profile</button>
    </form>
    <div id="profileResult"></div>
</div>

-->

<!--original???<div id="tutorProfileSection" style="display: none;">
    <h2>Create Your Tutor Profile</h2>
    <form id="tutorProfileForm">
        <textarea id="bio" placeholder="Tell students about yourself, list the subjects you teach, your experience, teaching style..." rows="4" required></textarea>
        <input type="number" id="hourlyRate" placeholder="Hourly Rate ($)" min="10" max="200" step="0.50" required>
        <input type="tel" id="phone" placeholder="Phone Number (optional)">
        <button type="submit">Create Profile</button>
    </form>
    <div id="profileResult"></div>
</div>-->
<!--show all  Tutor -->
<!--made on 7.22-->
<div id="tutorProfileSection" style="display: none;">
    <h2>Create Your Tutor Profile</h2>
    <form id="tutorProfileForm">
        
        <!-- NEW: Subject selection checkboxes -->
        <!-- This shows when user clicks "Create Tutor Profile" -->
        <fieldset style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
            <legend><strong>What subjects do you teach?</strong></legend>
            <div id="subjectCheckboxes">
                <!-- Each checkbox has value="1" matching your subjects table IDs -->
                <input type="checkbox" name="subjects" value="1" id="math"> 
                <label for="math">Math</label><br>
                
                <input type="checkbox" name="subjects" value="2" id="french"> 
                <label for="french">French</label><br>
                
                <input type="checkbox" name="subjects" value="3" id="piano"> 
                <label for="piano">Piano</label><br>
                
                <input type="checkbox" name="subjects" value="4" id="programming"> 
                <label for="programming">Programming</label><br>
            </div>
        </fieldset>
        
        <!-- EXISTING: Bio, rate, phone (unchanged) -->
        <textarea id="bio" placeholder="Tell students about yourself, your experience, teaching style..." rows="4" required></textarea>
        <input type="number" id="hourlyRate" placeholder="Hourly Rate ($)" min="0" max="200" step="0.50" required>
        <input type="tel" id="phone" placeholder="Phone Number (optional)">
        
        <button type="submit">Create Profile</button>
    </form>
    <div id="profileResult"></div>
</div>



<!-- Registration Form -->
<div id="registerSection">

    <h2>Create Account</h2>
    <form id="registerForm">
        <input type="email" id="regEmail" placeholder="Email" required>
        <input type="password" id="regPassword" placeholder="Password" required>
        <select id="regRole" required>
            <option value="">Choose your role</option>
            <option value="student">I'm a Student</option>
            <option value="tutor">I'm a Tutor</option>
        </select>
        <button type="submit">Sign Up</button>
    </form>
    <div id="registerResult"></div>
</div>


<!--student profile 8.5-->
<!-- NEW: Student Profile Creation Form -->
<div id="studentProfileSection" style="display: none;">
    <h2>Create Your Student Profile</h2>
    <p>Help tutors understand your learning goals and how they can best help you.</p>
    
    <form id="studentProfileForm">
        <div style="margin-bottom: 15px;">
            <label><strong>What grade level or academic background are you?</strong></label>
            <select id="gradeLevel" style="width: 100%; padding: 8px; margin-top: 5px;" required>
                <option value="">Choose your level</option>
                <option value="High School">High School</option>
                <option value="College Freshman">College Freshman</option>
                <option value="College Sophomore">College Sophomore</option>
                <option value="College Junior">College Junior</option>
                <option value="College Senior">College Senior</option>
                <option value="Graduate Student">Graduate Student</option>
                <option value="Adult Learner">Adult Learner</option>
                <option value="Professional">Working Professional</option>
            </select>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>What are your main learning goals?</strong></label>
            <textarea id="learningGoals" placeholder="e.g., I want to build websites, pass my calculus exam, learn Spanish for travel..." 
                      style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>What subjects are you currently working on?</strong></label>
            <textarea id="currentSubjects" placeholder="e.g., Python programming, Algebra 2, SAT prep, Spanish conversation..." 
                      style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>How do you learn best?</strong></label>
            <textarea id="learningStyle" placeholder="e.g., I need lots of practice problems, I learn better with visual examples, I prefer step-by-step explanations..." 
                      style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>Tell tutors about your academic background</strong></label>
            <textarea id="academicBackground" placeholder="e.g., Computer Science major at State University, homeschooled student, returning to school after 10 years..." 
                      style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>Why do you need tutoring help right now?</strong></label>
            <textarea id="whyNeedHelp" placeholder="e.g., Struggling with my CS homework, want to get ahead in math, preparing for a big exam..." 
                      style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label><strong>Phone Number (optional)</strong></label>
            <input type="tel" id="studentPhone" placeholder="Your phone number" 
                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <button type="submit">Create Profile</button>
    </form>
    <div id="studentProfileResult"></div>
</div>


<!--search tutors 7.12-->
<div id="tutorMarketplace">
    <h2>Find a Tutor</h2>
    
    <!-- Search form -->
    <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
        <input type="text" id="subjectSearch" placeholder="Search by subject (e.g., Math, Physics, Chemistry)" style="padding: 8px; width: 300px;">

<!--price search 7.13 end @ select -->

    <select id="priceFilter" style="padding: 8px; margin-left: 10px;">
        <option value="">Any Price</option>
        <option value="under20">Under $20/hour</option>
        <option value="20to30">$20-30/hour</option>
        <option value="30to50">$30-50/hour</option>
        <option value="over50">Over $50/hour</option>
    </select>
        <button onclick="searchTutors()">Search</button>
        <button onclick="loadAllTutors()">Show All</button>
    </div>
    
    <div id="tutorList"></div>
<!--7.23 added for bettr tutor contact  -->
<!-- NEW: Contact Modal (initially hidden) -->
<div id="contactModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
        
        <!-- Modal Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
            <h2 id="modalTutorName" style="margin: 0; color: #2c5aa0;">Contact Tutor</h2>
            <button onclick="closeContactModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
        </div>

        <!-- Tutor Info Summary -->
        <div id="modalTutorInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <!-- This will be filled by JavaScript -->
        </div>

        <!-- Contact Options -->
        <div style="space-y: 15px;">
            <!-- Email Section -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 18px; margin-right: 8px;">📧</span>
                    <strong>Email</strong>
                </div>
                <div style="display: flex; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                    <span id="modalEmail" style="flex: 1; font-family: monospace;">tutor@email.com</span>
                    <button id="emailButton" onclick="openEmail()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 10px;">Email</button>
                </div>
            </div>

            <!-- Phone Section -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 18px; margin-right: 8px;">📞</span>
                    <strong>Phone</strong>
                </div>
                <div style="display: flex; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                    <span id="modalPhone" style="flex: 1; font-family: monospace;">Phone number</span>
                    <button id="phoneButton" onclick="openPhone()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 10px;">Call</button>
                </div>
            </div>

            <!-- Message Template -->
            <div style="margin-bottom: 20px;">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 18px; margin-right: 8px;">💬</span>
                    <strong>Message Template</strong>
                </div>
                <textarea id="messageTemplate" readonly style="width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa; resize: none;">Hi! I found your tutoring profile and I'm interested in learning more about your teaching services. Could we schedule a time to discuss my learning goals and your availability? Thank you!</textarea>
                <button onclick="copyMessage()" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 12px;">Copy Message</button>
            </div>
        </div>

        <!-- Close Button -->
        <div style="text-align: center;">
            <button onclick="closeContactModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Close</button>
        </div>
    </div>
</div> 
</div>

<!-- Tutor Availability Section 7.24-->
<div id="availabilitySection" style="display: none;">
    <h2>Set Your Teaching Availability</h2>
    <p>Students will only be able to book during the times you set below.</p>
    
    <!-- Form to add availability -->
    <form id="availabilityForm">
        <label for="dayOfWeek"><strong>Day of Week:</strong></label>
        <select id="dayOfWeek" required>
            <option value="">Choose a day</option>
            <option value="monday">Monday</option>
            <option value="tuesday">Tuesday</option>
            <option value="wednesday">Wednesday</option>
            <option value="thursday">Thursday</option>
            <option value="friday">Friday</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
        </select>
        
        <label for="startTime"><strong>Start Time:</strong></label>
        <input type="time" id="startTime" required>
        
        <label for="endTime"><strong>End Time:</strong></label>
        <input type="time" id="endTime" required>
        
        <button type="submit">Add Availability</button>
    </form>
    
    <div id="availabilityResult"></div>
    
    <!-- Display current availability -->
    <h3>Your Current Availability</h3>
    <div id="currentAvailability">
        <!-- This will be filled by JavaScript -->
    </div>
</div>

<!--Booking Modal 7.27 -->
<div id="bookingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001;">
    <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 20px; border-radius: 10px; width: 95%; max-width: 500px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin-bottom: 20px;">
        
        <!-- Modal Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
            <h2 id="bookingTutorName" style="margin: 0; color: #28a745;">Book a Session</h2>
            <button onclick="closeBookingModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
        </div>

        <!-- Tutor Info -->
        <div id="bookingTutorInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <!-- This will be filled by JavaScript -->
        </div>

        <!-- Available Time Slots -->
        <div style="margin-bottom: 20px;">
            <h3>Available Times</h3>
            <div id="availableSlots">
                Loading available times...
            </div>
        </div>

        <!-- Close Button -->
        <div style="text-align: center;">
            <button onclick="closeBookingModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Close</button>
        </div>
    </div>
</div>


<!-- Study Resources Section 7.13 -->
<div id="resourcesSection" style="display: none;">
    <h2>Add Study Resource</h2>
    <form id="resourceForm">
        <input type="text" id="resourceTitle" placeholder="Resource Title" required>
        <input type="url" id="resourceUrl" placeholder="https://..." required>
        
        <select id="resourceSubject" required>
            <option value="">Select Subject</option>
            <option value="French">French</option>
            <option value="Math">Math</option>
            <option value="Programming">Programing</option>
            <option value="English">English</option>
            <option value="Physics">Physics</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Biology">Biology</option>
        </select>
        
        <select id="resourceLevel" required>
            <option value="">Select Level</option>
            <option value="Beginner">Beginner</option>
            <option value="Intermediate">Intermediate</option>
            <option value="Advanced">Advanced</option>
        </select>
        
        <select id="resourceType" required>
            <option value="">Select Type</option>
            <option value="Video">Video</option>
            <option value="Practice">Practice Problems</option>
            <option value="Article">Article</option>
            <option value="Course">Full Course</option>
        </select>
        
        <textarea id="resourceDescription" placeholder="Brief description of this resource..."></textarea>
        <button type="submit">Add Resource</button>
    </form>
    <div id="resourceResult"></div>
</div>

<!-- Browse Resources Section 7.13 companion to the //load all resources in script -->
<div id="browseResourcesSection" style="display: none;">
    <h2>Study Resources</h2>
    
    <!-- Filters -->
    <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
        <select id="resourceSubjectFilter">
            <option value="">Select Subject</option>
            <option value="">All Subjects</option>
            <option value="French">French</option>
            <option value="Math">Math</option>
            <option value="Programming">Programing</option>
            <option value="English">English</option>
            <option value="Physics">Physics</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Biology">Biology</option>
        </select>
        
        <select id="resourceLevelFilter">
            <option value="">All Levels</option>
            <option value="Beginner">Beginner</option>
            <option value="Intermediate">Intermediate</option>
            <option value="Advanced">Advanced</option>
        </select>
        
        <button onclick="filterResources()">Filter</button>
        <button onclick="loadAllResources()">Show All</button>
    </div>
    
    <div id="resourcesList"></div>
</div>
<!-- Music Resources Section 7.15 -->
<div id="musicResourcesSection" style="display: none;">
    <h2>Add Music Resource</h2>
    <form id="musicResourceForm">
        <input type="text" id="musicTitle" placeholder="Song/Playlist Title" required>
        <input type="url" id="musicUrl" placeholder="https://spotify.com/... or YouTube link" required>
        
        <select id="musicType" required>
            <option value="">Select Type</option>
            <option value="Focus Music">Focus Music</option>
            <option value="Study Playlist">Study Playlist</option>
            <option value="Background Sounds">Background Sounds</option>
            <option value="Hype Music">Hype Music</option>
            <option value="Just Good Music">Just Good Music</option>
            <option value="Other">Other</option>

        </select>
        
        <select id="musicGenre">
            <option value="">Select Genre (Optional)</option>
            <option value="Electronic">Electronic</option>
            <option value="Chill">Chill</option>
            <option value="Classical">Classical</option>
            <option value="Lo-fi">Lo-fi</option>
            <option value="Nature Sounds">Nature Sounds</option>
            <option value="Jazz">Jazz</option>
            <option value="Ambient">Ambient</option>
            <option value="Good Vibes">Good Vibes</option>

        </select>
        
        <select id="musicLanguage">
            <option value="">Select Language (Optional)</option>
            <option value="Instrumental">Instrumental</option>
            <option value="English">English</option>
            <option value="Spanish">Spanish</option>
            <option value="French">French</option>
            <option value="Mix">Mix</option>
            <option value="Other">Other</option>


        </select>
        
        <input type="text" id="musicDuration" placeholder="Duration (e.g., 30 min, 2 hours, Playlist)">
        <textarea id="musicDescription" placeholder="Why is this good for studying?"></textarea>
        
        <button type="submit">Add Music Resource</button>
    </form>
    <div id="musicResourceResult"></div>
</div>

<!-- Browse Music Resources Section 7.15-->
<div id="browseMusicSection" style="display: none;">
    <h2>Study Music Library</h2>
    
    <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
        <select id="musicTypeFilter">
            <option value="">All Types</option>
            <option value="Focus Music">Focus Music</option>
            <option value="Study Playlist">Study Playlist</option>
            <option value="Background Sounds">Background Sounds</option>
            <option value="Hype Music">Hype Music</option>
            <option value="Just Good Music">Just Good Music</option>
            <option value="Other">Other</option>


        </select>
        
        <select id="musicGenreFilter">
            <option value="">All Genres</option>
            <option value="Electronic">Electronic</option>
            <option value="Chill">Chill</option>
            <option value="Classical">Classical</option>
            <option value="Lo-fi">Lo-fi</option>
            <option value="Nature Sounds">Nature Sounds</option>
            <option value="Jazz">Jazz</option>
            <option value="Ambient">Ambient</option>
            <option value="Good Vibes">Good Vibes</option>


        </select>
        
        <button onclick="filterMusic()">Filter</button>
        <button onclick="loadAllMusic()">Show All</button>
    </div>
    
    <div id="musicList"></div>
</div>

    <script>

console.log('🚀 Script starting to load...');
/*function showStudentProfileOption() {
    document.getElementById('studentProfileSection').style.display = 'block';
    addCloseButton('studentProfileSection');
}
*/
console.log('✅ showStudentProfileOption defined');

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // Stop form from refreshing page

document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault(); // This prevents URL changes was having ? at the end             
            // Get form values
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Call your API
	     const response = await fetch('/tutor-api/auth/login',{		
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                // Show result
                const resultDiv = document.getElementById('result');
              //  if (data.success) {
                //    resultDiv.innerHTML = `<div class="success">Login successful! Welcome ${data.user.email}</div>`;

		if (data.success) {
    // Save token to browser storage
    localStorage.setItem('authToken', data.token);
    localStorage.setItem('userEmail', data.user.email);
    //8.5
    localStorage.setItem('userRole', data.user.role);

    
    // Show success and update UI
    resultDiv.innerHTML = `<div class="success">Login successful! Welcome ${data.user.email}</div>`;
    
    //hide stuff once logged in
    checkLoginStatus();

    // Hide login form, show logged-in content
    document.getElementById('loginForm').style.display = 'none';
    showLoggedInContent();
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                document.getElementById('result').innerHTML = `<div class="error">Connection error: ${error.message}</div>`;
            }
});
        }); 

//content when login and remember 
function checkLoginStatus() {
    const token = localStorage.getItem('authToken');
    const userEmail = localStorage.getItem('userEmail');
    
    if (token && userEmail) {
        // User has a token, they're logged in
        document.getElementById('loginForm').style.display = 'none';
        showLoggedInContent();
        hideLoginSections();        // Added this 7.15
        showLoggedInContent();
    } else {
        // No token, show login form
        document.getElementById('loginForm').style.display = 'block';
        hideLoggedInContent();
        showLoginSections();        // ← Added this 7.15
        hideLoggedInContent();
    }
}

//old showLoggedin before tutor and students sepearted 
/*

function showLoggedInContent() {
    const userEmail = localStorage.getItem('userEmail');
    
    // Create logged-in UI
    const loggedInDiv = document.createElement('div');
    loggedInDiv.id = 'loggedInContent';
    loggedInDiv.innerHTML = `
 <!--       <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h2>Welcome back, ${userEmail}!</h2>
            <button onclick="viewProfile()">My Profile</button>
<!-- OLD COMMEN	          <button onclick="showTutorMarketplace()">Browse Tutors</button>
            <button onclick="logout()">Logout</button>
        </div>-->

    `;
    
    // Add it to the page if not already there
    if (!document.getElementById('loggedInContent')) {
        document.body.appendChild(loggedInDiv);
    }
}
*/

//8.5
function showLoggedInContent() {
    const userEmail = localStorage.getItem('userEmail');
    const userRole = localStorage.getItem('userRole');
    
    let roleButtons = '';
    
    if (userRole === 'student') {
        roleButtons = `
            <button onclick="showStudentProfileOption()">Create Student Profile</button>
            <button onclick="showTutorMarketplace()">Find Tutors</button>
            <button onclick="showBrowseResourcesSection()">Browse Resources</button>
            <button onclick="showBrowseMusicSection()">Browse Study Music</button>
        `;
    } else if (userRole === 'tutor') {
        roleButtons = `
            <button onclick="showTutorProfileOption()">Create Tutor Profile</button>
            <button onclick="editProfile()">Edit Profile</button>
            <button onclick="showAvailabilitySection()">Set My Availability</button>
            <button onclick="showResourcesSection()">Add Study Resource</button>
            <button onclick="showMusicResourcesSection()">Add Study Music</button>
        `;
    }
    
    const loggedInDiv = document.createElement('div');
    loggedInDiv.id = 'loggedInContent';
    loggedInDiv.innerHTML = `
        <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h2>Welcome back, ${userEmail}! (${userRole})</h2>
            <button onclick="viewProfile()">My Profile</button>
            ${roleButtons}
            <button onclick="logout()">Logout</button>
        </div>
    `;
    
    if (!document.getElementById('loggedInContent')) {
        document.body.appendChild(loggedInDiv);
    }
}

//addedhideLogin sec and shloWloginSec 7.15
function hideLoginSections() {
    document.getElementById('loginSection').style.display = 'none';     // Hide login + heading
    document.getElementById('registerSection').style.display = 'none';
}

function showLoginSections() {
    document.getElementById('loginSection').style.display = 'block';    // Show login + heading
    document.getElementById('registerSection').style.display = 'block';
}


function hideLoggedInContent() {
    const content = document.getElementById('loggedInContent');
    if (content) {
        content.remove();
    }
}
//login con

//WtF DO IVE 2 SHOW LOGINCON? 
/*
function showLoggedInContent() {
    const userEmail = localStorage.getItem('userEmail');
    
    const loggedInDiv = document.createElement('div');
    loggedInDiv.id = 'loggedInContent';
    loggedInDiv.innerHTML = `

<!--        <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h2>Welcome back, ${userEmail}!</h2>
            <button onclick="viewProfile()">My Profile</button>
<!--            <button onclick="showTutorMarketplace()">Find Tutors</button>--
            <button onclick="showTutorProfileOption()">Create Tutor Profile</button>
            <button onclick="editProfile()">Edit Profile</button>
            <button onclick="showAvailabilitySection()">Set My Availability</button>  
            <button onclick="showResourcesSection()">Add Study Resource</button>
            <button onclick="showBrowseResourcesSection()">Browse Resources</button>
            <button onclick="showMusicResourcesSection()">Add Study Music</button>
            <button onclick="showBrowseMusicSection()">Browse Study Music Library</button>
            <button onclick="logout()">Logout</button>
        </div>-->

    `;
    
    if (!document.getElementById('loggedInContent')) {
        document.body.appendChild(loggedInDiv);
    }
}
*/

// A close button to sections 7.16
function addCloseButton(sectionId) {
    const section = document.getElementById(sectionId);
    if (section && !section.querySelector('.close-button')) {
        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '✕ Close';
        closeBtn.className = 'close-button';
        closeBtn.style.cssText = 'float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-bottom: 10px;';
        closeBtn.onclick = () => {
            section.style.display = 'none';
        };
        section.insertBefore(closeBtn, section.firstChild);
    }
}

// Check login status when page loads
window.onload = function() {
    checkLoginStatus();
};

//make buttons work so user logout and goes to profile 
async function viewProfile() {
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch('/tutor-api/profile', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
        
        const data = await response.json();
        
        if (data.user) {
            alert(`Profile: ${data.user.email} (Role: ${data.user.role})`);
        } else {
            alert('Error: ' + data.error);
        }
    } catch (error) {
        alert('Connection error: ' + error.message);
    }
}

function logout() {
    // Clear stored token
    localStorage.removeItem('authToken');
    localStorage.removeItem('userEmail');
    
    // Refresh the page to show login form
    location.reload();
}

// Show tutor profile form for logged-in users
function showTutorProfileOption() {
    const tutorSection = document.getElementById('tutorProfileSection');
    tutorSection.style.display = 'block';
    addCloseButton('tutorProfileSection');  // ← Added 7.16

}
document.getElementById('tutorProfileForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const bio = document.getElementById('bio').value;
    const hourlyRate = document.getElementById('hourlyRate').value;
    const phone = document.getElementById('phone').value;
    const token = localStorage.getItem('authToken');
    
    // Get selected subjects
    const selectedSubjects = [];
    const checkboxes = document.querySelectorAll('input[name="subjects"]:checked');
    checkboxes.forEach(cb => selectedSubjects.push(parseInt(cb.value)));

//debug 7.22
    console.log('Selected subjects:', selectedSubjects);
    console.log('Sending to server:', { bio, hourly_rate: hourlyRate, phone, subjects: selectedSubjects });
    
    const isEditMode = document.getElementById('tutorProfileForm').dataset.mode === 'edit';
    const method = isEditMode ? 'PUT' : 'POST';

    try {
        const response = await fetch('/tutor-api/tutor-profile', {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                bio: bio,
                hourly_rate: hourlyRate,
                phone: phone,
                subjects: selectedSubjects
            })
        });
        
        const data = await response.json();
        const resultDiv = document.getElementById('profileResult');
        
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Profile created successfully!</div>';
            document.getElementById('tutorProfileForm').reset();
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        document.getElementById('profileResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }
});
/*commented out around 7.21? og code 
// Handle tutor profile form submission
document.getElementById('tutorProfileForm').addEventListener('submit', async function(e) {
    e.preventDefault(); // Stop form from refreshing page
    
    // Get form values using getElementById
    const bio = document.getElementById('bio').value;
    const hourlyRate = document.getElementById('hourlyRate').value;
    const phone = document.getElementById('phone').value;
    const token = localStorage.getItem('authToken');

//7.21 added subject 
    // NEW: Get selected subjects
    const selectedSubjects = [];
    const checkboxes = document.querySelectorAll('input[name="subjects"]:checked');
    checkboxes.forEach(cb => selectedSubjects.push(parseInt(cb.value)));
    
    const isEditMode = document.getElementById('tutorProfileForm').dataset.mode === 'edit';
    const method = isEditMode ? 'PUT' : 'POST';

    try {
        const response = await fetch('/tutor-api/tutor-profile', {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                bio: bio,
                hourly_rate: hourlyRate,
                phone: phone,
                subjects: selectedSubjects  // NEW: Include subjects
            })
        });
        
    }
});
console.log('✅ Point 3');

//end edit 7.21

//edit form handler 7.17 ends @ method
const isEditMode = document.getElementById('tutorProfileForm').dataset.mode === 'edit';
const method = isEditMode ? 'PUT' : 'POST';

    try {
        const response = await fetch('/tutor-api/tutor-profile', {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                bio: bio,
                hourly_rate: hourlyRate,
                phone: phone
            })
        });
        
        const data = await response.json();
        
        // Show result using getElementById
        const resultDiv = document.getElementById('profileResult');
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Profile created successfully!</div>';
            document.getElementById('tutorProfileForm').reset(); // Clear form
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        document.getElementById('profileResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }
 
});
*/


//show all tutors 
async function loadAllTutors() {  // <- renamed from loadTutors
    try {
        const response = await fetch('/tutor-api/tutors');
        const data = await response.json();
        displayTutors(data);  // <- use the new display function

    } catch (error) {

        document.getElementById('tutorList').innerHTML = '<p>Error loading tutors.</p>';
    }
}

//new display tutor updated w/ hide button 7.16
function displayTutors(data) {
    const tutorListDiv = document.getElementById('tutorList');
    
    if (data.success && data.tutors.length > 0) {
        // Build tutors first
        const tutorCards = data.tutors.map(tutor => `
<!--old            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">-->
		<div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; word-wrap: break-word; overflow-wrap: break-word;">
                <h3>${tutor.email}</h3>
                <!-- NEW:7.23 Show subjects taught -->
                <p><strong>Teaches:</strong> 
                    <span style="color: #2c5aa0; font-weight: bold;">
                        ${tutor.subjects_taught || 'No subjects listed'}
                    </span>
                </p>
		<!--7.24 Add availability display -->
		<p><strong>Available:</strong> 
    		   <span style="color: #28a745; font-weight: bold;">
        	       ${tutor.availability_text || 'No times set'}
    		   </span>
		</p>
                <p><strong>About:</strong> ${tutor.bio}</p>
                <p><strong>Rate:</strong> $${tutor.hourly_rate}/hour</p>
                <p><strong>Phone:</strong> ${tutor.phone || 'Not provided'}</p>
<!--rip                <button onclick="showContact('${tutor.email}', '${tutor.phone}', {subjects: '${tutor.subjects_taught}', rate: '${tutor.hourly_rate}'})">Contact This Tutor</button>-->
 		<button onclick="showBookingModal('${tutor.profile_id}', '${tutor.email}', '${tutor.hourly_rate}')">Book Session </button> 
             <!--   <button onclick="showContact('${tutor.email}', '${tutor.phone}')">Contact This Tutor</button>-->
            </div>
        `).join('');
        
        // Combine button + tutors with proper structure
        const fullContent = `
            <div style="margin-bottom: 15px;">
                <button onclick="hideTutorResults()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Hide Results</button>
            </div>
            ${tutorCards}
        `;
        
        tutorListDiv.innerHTML = fullContent;
    } else {
        tutorListDiv.innerHTML = '<p>No tutors found.</p>';
    }
}

//7.16
function hideTutorResults() {
    document.getElementById('tutorList').innerHTML = '';
}

// Show marketplace to everyone (no login required)
function showTutorMarketplace() {
    document.getElementById('tutorMarketplace').style.display = 'block';
    addCloseButton('tutorMarketplace');
    console.log(typeof showTutorMarketplace);

}

// sign-up Handle registration form submission
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    addCloseButton('tutorMarketplace');  // ← Added 7.16

    // Get form values
    const email = document.getElementById('regEmail').value;
    const password = document.getElementById('regPassword').value;
    const role = document.getElementById('regRole').value;
    
    try {
        const response = await fetch('/tutor-api/users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: email,
                password: password,
                role: role
            })
        });
        
        const data = await response.json();
        const resultDiv = document.getElementById('registerResult');
        
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Account created! You can now log in.</div>';
            document.getElementById('registerForm').reset();
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        document.getElementById('registerResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }

});


//contact tutor 7.12
function showContact(email, phone) {
    const contactInfo = `
        <strong>Contact Information:</strong><br>
        Email: ${email}<br>
        Phone: ${phone || 'Not provided'}<br><br>
        <em>Send them an email or call to discuss tutoring sessions!</em>
    `;
    
    alert(contactInfo);
}

//added 7.23 in addition to code in html afer tutorList
//contact form 2.0 
// NEW: Global variables to store current tutor info
let currentTutorEmail = '';
let currentTutorPhone = '';

// NEW: Show the professional contact modal instead of ugly alert
function showContact(email, phone, tutorData = null) {
    // Store the contact info globally
    currentTutorEmail = email;
    currentTutorPhone = phone || 'Not provided';
    
    // Update modal content
    document.getElementById('modalTutorName').textContent = `Contact ${email}`;
    document.getElementById('modalEmail').textContent = email;
    document.getElementById('modalPhone').textContent = currentTutorPhone;
    
    // Update tutor info summary (if we have tutor data from the card)
    const tutorInfoDiv = document.getElementById('modalTutorInfo');
    if (tutorData) {
        tutorInfoDiv.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>📚 Teaches:</strong> ${tutorData.subjects || 'Not specified'}<br>
                    <strong>💰 Rate:</strong> $${tutorData.rate}/hour
                </div>
            </div>
        `;
    } else {
        // Fallback if no tutor data provided
        tutorInfoDiv.innerHTML = `
            <div style="text-align: center; color: #666;">
                <em>Contact this tutor to discuss their subjects and rates</em>
            </div>
        `;
    }
    
    // Show the modal
    document.getElementById('contactModal').style.display = 'block';
}

// NEW: Close the modal
function closeContactModal() {
    document.getElementById('contactModal').style.display = 'none';
}

// NEW: Open email client with tutor's email
function openEmail() {
    const subject = encodeURIComponent('Tutoring Inquiry');
    const body = encodeURIComponent(document.getElementById('messageTemplate').value);
    const mailtoLink = `mailto:${currentTutorEmail}?subject=${subject}&body=${body}`;
    window.open(mailtoLink);
}

// NEW: Open phone app (works on mobile)
function openPhone() {
    if (currentTutorPhone && currentTutorPhone !== 'Not provided') {
        window.open(`tel:${currentTutorPhone}`);
    } else {
        alert('No phone number available for this tutor.');
    }
}

// NEW: Copy message template to clipboard
function copyMessage() {
    const messageText = document.getElementById('messageTemplate');
    messageText.select();
    messageText.setSelectionRange(0, 99999); // For mobile devices
    
    try {
        document.execCommand('copy');
        // Show brief feedback
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.style.background = '#28a745';
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '#6c757d';
        }, 1000);
    } catch (err) {
        alert('Could not copy message. Please select and copy manually.');
    }
}

// NEW: Close modal when clicking outside of it
window.onclick = function(event) {
    const modal = document.getElementById('contactModal');
    if (event.target === modal) {
        closeContactModal();
    }
}
//end of contact



//idthink this works rn
async function editProfile(){

    const token = localStorage.getItem('authToken');
    addCloseButton('tutorProfileSection'); //added 7.16


    try{
	//get their info from server
	const response = await fetch('/tutor-api/my-tutor-profile',{
	   headers: {'Authorization': 'Bearer ' +token }
	});

	const data = await response.json();

	if (data.success) {
            document.getElementById('tutorProfileSection').style.display = 'block';

	   document.getElementById('bio').value = data.profile.bio;
	   document.getElementById('hourlyRate').value = data.profile.hourly_rate;
	   document.getElementById('phone').value = data.profile.phone;
//change button text
	   const button = document.querySelector('#tutorProfileForm button');
	   button.textContent = 'Update profile';

            document.getElementById('tutorProfileForm').dataset.mode = 'edit';

  }
}catch (error) {
	alert('Error loading profile');
 }
}

//search tutor by subjecct 7.12 deleted and replaced by price and subject search 
async function searchTutors() {
    const subject = document.getElementById('subjectSearch').value.trim();
    const priceFilter = document.getElementById('priceFilter').value;
    
    // Build URL with multiple parameters
    let url = '/tutor-api/tutors?';
    const params = [];
    
    if (subject) {
        params.push(`subject=${encodeURIComponent(subject)}`);
    }
    
    if (priceFilter) {
        params.push(`price=${priceFilter}`);
    }
    
    // If no filters, just load all tutors
    if (params.length === 0) {
        loadAllTutors();
        return;
    }
    
    url += params.join('&'); // Creates: ?subject=math&price=under20
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        displayTutors(data);
    } catch (error) {
        console.error('Search error:', error);
        document.getElementById('tutorList').innerHTML = '<p>Error searching tutors.</p>';
    }
}

//toggle down 7.16 
function toggleSection(sectionId) {
    console.log('Trying to toggle:', sectionId);
    const section = document.getElementById(sectionId);
    console.log('Found section:', section);
    
    if (!section) {
        console.log('Section not found!');
        return;
    }
    
    if (section.style.display === 'none' || section.style.display === '') {
        hideAllSections();
        section.style.display = 'block';
        console.log('Showing section');
        
        // Load content when showing specific sections
        if (sectionId === 'tutorMarketplace') {
            loadAllTutors();  // Load tutors when showing marketplace
        } else if (sectionId === 'browseResourcesSection') {
            loadAllResources();  // Load resources when showing browse resources
        } else if (sectionId === 'browseMusicSection') {
            loadAllMusic();  // Load music when showing browse music
        }
        
    } else {
        section.style.display = 'none';
        console.log('Hiding section');
    }
}

function hideAllSections() {
    document.getElementById('tutorProfileSection').style.display = 'none';
    document.getElementById('tutorMarketplace').style.display = 'none';
    document.getElementById('resourcesSection').style.display = 'none';
    document.getElementById('browseResourcesSection').style.display = 'none';
    document.getElementById('musicResourcesSection').style.display = 'none';
    document.getElementById('browseMusicSection').style.display = 'none';
}

//booking 7.25
//function showBookingModal(tutorId, tutorEmail, hourlyRate){
  //        alert(`Booking modal for tutor: ${tutorEmail}, Rate: $${hourlyRate}/hr, ID: ${tutorId}`);
//}
// Show booking modal for students 7.27
function showBookingModal(tutorId, tutorEmail, hourlyRate, subjects) {
    // Store tutor info for later use
    window.currentBookingTutor = {
        id: tutorId,
        email: tutorEmail,
        rate: hourlyRate,
        subjects: subjects
    };
    
    // Update modal content
    document.getElementById('bookingTutorName').textContent = `Book Session with ${tutorEmail}`;
    
    // Update tutor info summary
    const tutorInfoDiv = document.getElementById('bookingTutorInfo');
    tutorInfoDiv.innerHTML = `
        <div>
            <strong>Tutor:</strong> ${tutorEmail}<br>
            <strong>Teaches:</strong> ${subjects || 'Not specified'}<br>
            <strong>Rate:</strong> $${hourlyRate}/hour
        </div>
    `;
    
    // Show the modal
    document.getElementById('bookingModal').style.display = 'block';
    
    // Load available time slots (we'll create this function next)
    loadAvailableSlots(tutorId);
}




// NEW: Close booking modal
function closeBookingModal() {
    document.getElementById('bookingModal').style.display = 'none';
}

// NEW: Placeholder for loading available slots
//function loadAvailableSlots(tutorId) {
  //  document.getElementById('availableSlots').innerHTML = 'Loading available times...';
    // We'll add the real functionality next
//}
// NEW: Load available time slots for booking
async function loadAvailableSlots(tutorId) {
    try {
        const response = await fetch(`/tutor-api/availability/${tutorId}`);
        const data = await response.json();
        
        const slotsDiv = document.getElementById('availableSlots');
        
        if (data.success && data.availability.length > 0) {
            const timeSlots = data.availability.map(slot => `
                <button onclick="selectTimeSlot('${slot.day_of_week}', '${slot.start_time}', '${slot.end_time}')" 
                        style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                    ${capitalizeFirst(slot.day_of_week)} ${formatTime(slot.start_time)} - ${formatTime(slot.end_time)}
                </button>
            `).join('');
            
            slotsDiv.innerHTML = timeSlots;
        } else {
            slotsDiv.innerHTML = '<p style="color: #666;">No available times set by this tutor.</p>';
        }
        
    } catch (error) {
        console.error('Error loading available slots:', error);
        document.getElementById('availableSlots').innerHTML = '<p style="color: red;">Error loading available times.</p>';
    }
}
//
// Handle time slot selection with booking form 7.28
function selectTimeSlot(dayOfWeek, startTime, endTime) {
    // Store the selected time slot
    window.selectedTimeSlot = {
        day: dayOfWeek,
        start: startTime,
        end: endTime
    };
    
    const tutor = window.currentBookingTutor;
    
    // Show booking form
    const slotsDiv = document.getElementById('availableSlots');
// In your selectTimeSlot function, replace the innerHTML with:
slotsDiv.innerHTML = `
    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <h4 style="margin: 0 0 10px 0; color: #28a745;">Selected Time Slot</h4>
        <p style="margin: 0;"><strong>${capitalizeFirst(dayOfWeek)} ${formatTime(startTime)} - ${formatTime(endTime)}</strong></p>
        <p style="margin: 5px 0 0 0; font-size: 14px;">Rate: $${tutor.rate}/hour</p>
    </div>
    
    <h4 style="margin-bottom: 15px;">Tell ${tutor.email.split('@')[0]} about yourself:</h4>
    
    <div style="margin-bottom: 15px;">
        <label><strong>What are you currently working on or studying?</strong></label>
        <textarea id="currentWork" placeholder="e.g., Learning Python for my CS class, preparing for SATs, working on calculus homework..." 
                  style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
    </div>
    
    <div style="margin-bottom: 15px;">
        <label><strong>What specific challenge are you facing?</strong></label>
        <textarea id="currentChallenge" placeholder="e.g., I understand basic Python syntax but get confused with functions and loops..." 
                  style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
    </div>
    
    <div style="margin-bottom: 15px;">
        <label><strong>What's your learning goal for this session?</strong></label>
        <textarea id="learningGoal" placeholder="e.g., I want to understand how functions work and finish my calculator project..." 
                  style="width: 100%; height: 60px; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
    </div>
    
    <div style="margin-bottom: 15px;">
        <label><strong>How long would you like the session to be?</strong></label>
        <select id="sessionDuration" style="width: 100%; padding: 8px; margin-top: 5px;">
            <option value="0.5">30 minutes - $${(tutor.rate * 0.5).toFixed(2)}</option>
            <option value="1">1 hour - $${tutor.rate}</option>
            <option value="1.5">1.5 hours - $${(tutor.rate * 1.5).toFixed(2)}</option>
            <option value="2">2 hours - $${(tutor.rate * 2).toFixed(2)}</option>
        </select>
    </div>
<!-- preferred time field 7.28 -->
   <div style="margin-bottom: 15px;">
       <label><strong>What specific time within ${capitalizeFirst(dayOfWeek)} ${formatTime(startTime)}-${formatTime(endTime)} works best for you?</strong></label>
          <input type="text" id="preferredTime" placeholder="e.g., 2pm-4pm, around 10am, morning preferred, I'm flexible" 
           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" required>
      <small style="color: #666; font-size: 12px;">Help the tutor know your preferred time within their available window</small>
</div>

    
    <button onclick="sendSessionRequest()" 
            style="width: 100%; background: #007bff; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Send Session Request
    </button>
    
    <button onclick="loadAvailableSlots(${tutor.id})" 
            style="width: 100%; background: #6c757d; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
        ← Back to Time Selection
    </button>
`;

}

// Send session request with student introduction 7.28
function sendSessionRequest() {
    const tutor = window.currentBookingTutor;
    const timeSlot = window.selectedTimeSlot;
    
    // Get all form values
    const currentWork = document.getElementById('currentWork').value.trim();
    const currentChallenge = document.getElementById('currentChallenge').value.trim();
    const learningGoal = document.getElementById('learningGoal').value.trim();
    const duration = document.getElementById('sessionDuration').value;
    const preferredTime = document.getElementById('preferredTime').value.trim();
    

    // Basic validation
    if (!currentWork || !currentChallenge || !learningGoal || !preferredTime) {       
        alert('Please fill in all the introduction fields so the tutor can understand your needs.');
        return;
    }
    
    // Calculate total amount
    const totalAmount = (tutor.rate * parseFloat(duration)).toFixed(2);
    
    // Show detailed confirmation
    const confirmMessage = `Session Request Summary:

Tutor: ${tutor.email}
Time: ${capitalizeFirst(timeSlot.day)} ${formatTime(timeSlot.start)} - ${formatTime(timeSlot.end)}
Preferred Time: ${preferredTime}
Duration: ${duration} hours ($${totalAmount})

Your Introduction:
- Working on: ${currentWork}
- Challenge: ${currentChallenge}  
- Goal: ${learningGoal}

Send this request to ${tutor.email}?`;
    
if (confirm(confirmMessage)) {
    // Show loading state
    const originalButton = document.querySelector('button[onclick="sendSessionRequest()"]');
    originalButton.textContent = 'Sending Request...';
    originalButton.disabled = true;
    
    // Send actual request to backend
    sendRequestToServer(tutor, timeSlot, currentWork, currentChallenge, learningGoal, duration, totalAmount, preferredTime);
}

}
//7.28
// Send request to server (FRONTEND SIDE)
async function sendRequestToServer(tutor, timeSlot, currentWork, currentChallenge, learningGoal, duration, totalAmount, preferredTime) {
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch('/tutor-api/session-request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                tutor_id: tutor.id,
                tutor_email: tutor.email,
                day_of_week: timeSlot.day,
                start_time: timeSlot.start,
                end_time: timeSlot.end,
                duration: duration,
                current_work: currentWork,
                current_challenge: currentChallenge,
                learning_goal: learningGoal,
                preferred_time: preferredTime,  
                total_amount: totalAmount
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert(`✅ Request sent successfully! ${tutor.email} will receive your introduction and respond via email.`);
            closeBookingModal();
        } else {
            alert(`❌ Error sending request: ${data.error}`);
        }
        
    } catch (error) {
        console.error('Error sending session request:', error);
        alert('❌ Connection error. Please try again.');
    }
}
//8.6🧑‍🎓
function showStudentProfileOption() {
    document.getElementById('studentProfileSection').style.display = 'block';
    addCloseButton('studentProfileSection');
    
    // NEW: Attach event listener when form becomes visible
    const form = document.getElementById('studentProfileForm');
    console.log('🔍 Form now visible, attaching listener...');
    
    // Remove any existing listener (prevent duplicates)
    const newForm = form.cloneNode(true);
    form.parentNode.replaceChild(newForm, form);
    
    // Add fresh event listener
newForm.addEventListener('submit', async function(e) {
    console.log('🔍 Form submission started!');
    e.preventDefault();
    
    // Get form values
    const gradeLevel = document.getElementById('gradeLevel').value;
    const learningGoals = document.getElementById('learningGoals').value.trim();
    const currentSubjects = document.getElementById('currentSubjects').value.trim();
    const learningStyle = document.getElementById('learningStyle').value.trim();
    const academicBackground = document.getElementById('academicBackground').value.trim();
    const whyNeedHelp = document.getElementById('whyNeedHelp').value.trim();
    const phone = document.getElementById('studentPhone').value.trim();
    const token = localStorage.getItem('authToken');
    
    console.log('🔍 All form values:', {
        gradeLevel, learningGoals, currentSubjects, 
        learningStyle, academicBackground, whyNeedHelp, phone
    });
    console.log('🔍 Auth token exists:', !!token);
    
    // Validation
    if (!gradeLevel || !learningGoals || !currentSubjects || !learningStyle || !academicBackground || !whyNeedHelp) {
        console.log('❌ Validation failed - missing required fields');
        alert('Please fill in all required fields.');
        return;
    }
    console.log('✅ Validation passed');
    
    // Network request
    console.log('🔍 Making API request to /tutor-api/student-profile');
    
    try {
        const response = await fetch('/tutor-api/student-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                grade_level: gradeLevel,
                learning_goals: learningGoals,
                current_subjects: currentSubjects,
                learning_style: learningStyle,
                academic_background: academicBackground,
                why_need_help: whyNeedHelp,
                phone: phone
            })
        });
        
        console.log('🔍 API Response status:', response.status);
        console.log('🔍 API Response ok:', response.ok);
        
        const data = await response.json();
        console.log('🔍 API Response data:', data);
        
        // Handle response
        const resultDiv = document.getElementById('studentProfileResult');
        if (data.success) {
            console.log('✅ Success! Profile created');
            resultDiv.innerHTML = '<div style="color: green;">Student profile created successfully!</div>';
        } else {
            console.log('❌ Server returned error:', data.error);
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        console.log('❌ Network error:', error);
        alert('Connection error: ' + error.message);
    }
});


}



// Handle study resource form submission 7.13
document.getElementById('resourceForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const title = document.getElementById('resourceTitle').value;
    const url = document.getElementById('resourceUrl').value;
    const subject = document.getElementById('resourceSubject').value;
    const level = document.getElementById('resourceLevel').value;
    const type = document.getElementById('resourceType').value;
    const description = document.getElementById('resourceDescription').value;
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch('/tutor-api/study-resources', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                title: title,
                url: url,
                subject: subject,
                level: level,
                type: type,
                description: description
            })
        });
        
        const data = await response.json();
        const resultDiv = document.getElementById('resourceResult');
        
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Resource added successfully!</div>';
            document.getElementById('resourceForm').reset(); // Clear form
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        document.getElementById('resourceResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }
});
//availability
// Show the availability section 7.24
function showAvailabilitySection() {
    document.getElementById('availabilitySection').style.display = 'block';
    addCloseButton('availabilitySection'); // Add close button like other sections
    loadCurrentAvailability(); // Load tutor's existing availability
}

// NEW: Load and display tutor's current availability
async function loadCurrentAvailability() {
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch('/tutor-api/my-availability', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
        
        const data = await response.json();
        const availabilityDiv = document.getElementById('currentAvailability');
        
        if (data.success && data.availability.length > 0) {
            // Display each availability slot
            const availabilityCards = data.availability.map(slot => `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                    <span><strong>${capitalizeFirst(slot.day_of_week)}</strong>: ${formatTime(slot.start_time)} - ${formatTime(slot.end_time)}</span>
                    <button onclick="deleteAvailability(${slot.id})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
            
            availabilityDiv.innerHTML = availabilityCards;
        } else {
            availabilityDiv.innerHTML = '<p style="color: #666;"><em>No availability set yet. Add some times above!</em></p>';
        }
        
    } catch (error) {
        console.error('Error loading availability:', error);
        document.getElementById('currentAvailability').innerHTML = '<p style="color: red;">Error loading availability.</p>';
    }
}

// NEW: Helper function to capitalize first letter
function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// NEW: Helper function to format time (converts 09:00:00 to 9:00 AM)
function formatTime(timeString) {
    const time = new Date('2000-01-01 ' + timeString);
    return time.toLocaleTimeString('en-US', { 
        hour: 'numeric', 
        minute: '2-digit',
        hour12: true 
    });
}

//
// NEW: Handle availability form submission
document.getElementById('availabilityForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const dayOfWeek = document.getElementById('dayOfWeek').value;
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;
    const token = localStorage.getItem('authToken');
    
    // Basic validation
    if (!dayOfWeek || !startTime || !endTime) {
        document.getElementById('availabilityResult').innerHTML = '<div style="color: red;">Please fill in all fields.</div>';
        return;
    }
    
    if (startTime >= endTime) {
        document.getElementById('availabilityResult').innerHTML = '<div style="color: red;">End time must be after start time.</div>';
        return;
    }
    
    try {
        const response = await fetch('/tutor-api/availability', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                day_of_week: dayOfWeek,
                start_time: startTime,
                end_time: endTime
            })
        });
        
        const data = await response.json();
        const resultDiv = document.getElementById('availabilityResult');
        
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Availability added successfully!</div>';
            document.getElementById('availabilityForm').reset(); // Clear form
            loadCurrentAvailability(); // Refresh the availability list
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        console.error('Error adding availability:', error);
        document.getElementById('availabilityResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }
});
//
// Delete an availability slot 7.24
async function deleteAvailability(availabilityId) {
    if (!confirm('Are you sure you want to delete this availability slot?')) {
        return; // User cancelled
    }
    
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch(`/tutor-api/availability/${availabilityId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Refresh the availability list
            loadCurrentAvailability();
        } else {
            alert('Error deleting availability: ' + data.error);
        }
        
    } catch (error) {
        console.error('Error deleting availability:', error);
        alert('Connection error while deleting availability');
    }
}



// Function to show the resources section
function showResourcesSection() {
    document.getElementById('resourcesSection').style.display = 'block';
}
    addCloseButton('resourcesSection');  // ← Add this line

// Load all resources- 7.13 companion to the html above 
async function loadAllResources() {
    try {
        const response = await fetch('/tutor-api/study-resources');
        const data = await response.json();
        displayResources(data);
    } catch (error) {
        document.getElementById('resourcesList').innerHTML = '<p>Error loading resources.</p>';
    }
}

// Filter resources
async function filterResources() {
    const subject = document.getElementById('resourceSubjectFilter').value;
    const level = document.getElementById('resourceLevelFilter').value;
    
    let url = '/tutor-api/study-resources?';
    const params = [];
    
    if (subject) params.push(`subject=${subject}`);
    if (level) params.push(`level=${level}`);
    
    url += params.join('&');
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        displayResources(data);
    } catch (error) {
        document.getElementById('resourcesList').innerHTML = '<p>Error filtering resources.</p>';
    }
}

// Display resources
function displayResources(data) {
    const resourcesListDiv = document.getElementById('resourcesList');
    
    if (data.success && data.resources.length > 0) {
        const resourceCards = data.resources.map(resource => `
            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                <h3><a href="${resource.url}" target="_blank">${resource.title}</a></h3>
                <p><strong>Subject:</strong> ${resource.subject} | <strong>Level:</strong> ${resource.level} | <strong>Type:</strong> ${resource.type}</p>
                <p>${resource.description || 'No description provided'}</p>
                <small>Added by: ${resource.added_by_email || 'Unknown'}</small>
            </div>
        `).join('');
        
        resourcesListDiv.innerHTML = resourceCards;
    } else {
        resourcesListDiv.innerHTML = '<p>No resources found.</p>';
    }
}

// Show browse resources section
function showBrowseResourcesSection() {
    document.getElementById('browseResourcesSection').style.display = 'block';
    loadAllResources(); // Auto-load when section opens
    addCloseButton('browseResourcesSection');  // ← Added 7.16

}                                    


// Handle music resource form submission 7.15
document.getElementById('musicResourceForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const title = document.getElementById('musicTitle').value;
    const url = document.getElementById('musicUrl').value;
    const music_type = document.getElementById('musicType').value;
    const genre = document.getElementById('musicGenre').value;
    const language = document.getElementById('musicLanguage').value;
    const duration = document.getElementById('musicDuration').value;
    const description = document.getElementById('musicDescription').value;
    const token = localStorage.getItem('authToken');
    
    try {
        const response = await fetch('/tutor-api/music-resources', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                title, url, music_type, genre, language, duration, description
            })
        });
        
        const data = await response.json();
        const resultDiv = document.getElementById('musicResourceResult');
        
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">Music resource added successfully!</div>';
            document.getElementById('musicResourceForm').reset();
        } else {
            resultDiv.innerHTML = '<div style="color: red;">Error: ' + data.error + '</div>';
        }
        
    } catch (error) {
        document.getElementById('musicResourceResult').innerHTML = '<div style="color: red;">Connection error</div>';
    }
});

// Function to show music resources section
function showMusicResourcesSection() {
    document.getElementById('musicResourcesSection').style.display = 'block';
}
    addCloseButton('musicResourcesSection');  // ← Added 7.16

// Load all music resources 7.15
async function loadAllMusic() {
    try {
        const response = await fetch('/tutor-api/music-resources');
        const data = await response.json();
        displayMusic(data);
    } catch (error) {
        document.getElementById('musicList').innerHTML = '<p>Error loading music.</p>';
    }
}

// Display music resources
function displayMusic(data) {
    const musicListDiv = document.getElementById('musicList');
    
    if (data.success && data.resources.length > 0) {
        const musicCards = data.resources.map(music => `
            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f9f9f9;">
                <h3><a href="${music.url}" target="_blank">🎵 ${music.title}</a></h3>
                <p><strong>Type:</strong> ${music.music_type} | <strong>Genre:</strong> ${music.genre || 'Not specified'}</p>
                <p><strong>Language:</strong> ${music.language || 'Not specified'} | <strong>Duration:</strong> ${music.duration || 'Not specified'}</p>
                <p>${music.description || 'No description provided'}</p>
                <small>Added: ${new Date(music.created_at).toLocaleDateString()}</small>
            </div>
        `).join('');
        
        musicListDiv.innerHTML = musicCards;
    } else {
        musicListDiv.innerHTML = '<p>No music resources found. Be the first to add some!</p>';
    }
}

// Show browse music section
function showBrowseMusicSection() {
    document.getElementById('browseMusicSection').style.display = 'block';
    loadAllMusic(); // Auto-load when section opens
    addCloseButton('browseMusicSection');  // ← Added 7.16

}
function testFunction() {
    alert('Test works!');
}
    </script>
</body>
</html>
